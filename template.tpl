___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "TrafficMile Pixel Tracking",
  "categories": ["AFFILIATE_MARKETING", "ANALYTICS", "CONVERSIONS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Traffic Mile tracking script template.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "tenant",
    "displayName": "Your Account Name",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "siteID",
    "displayName": "Site ID",
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "fire",
    "displayName": "Type of tracking",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "nativepixel",
        "displayValue": "Native Traffic Pixel"
      },
      {
        "value": "goalpixel",
        "displayValue": "Goal Pixel"
      },
      {
        "value": "bcpixel",
        "displayValue": "Backward Compatibility Pixel"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "goal",
    "displayName": "Goal name",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "callback",
    "displayName": "Custom Callback JS Code",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "tid",
    "displayName": "Tracking Parameter Name (Default: click_id)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "cname",
    "displayName": "Custom Tracking Domain (If used, enter full URL)",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setInWindow = require('setInWindow');
const encodeUri = require('encodeUri');

const endpoint = encodeUri(data.cname ? data.cname : 'https://' + data.tenant + '.mytrack.pro');

const _tracking = {
  SRC: endpoint,
  SITE_ID: data.siteID,
  TRACKING: {
    FIRE: data.fire,
  },
};

if(data.goal) {
  _tracking.TRACKING.ACTION = data.goal;
}

if(data.callback) {
  _tracking.TRACKING.CALLBACK = data.callback;
}

if(data.tid) {
  _tracking.TID = data.tid;
}

setInWindow('TMTRACK', _tracking, true);

if (queryPermission('inject_script', endpoint + '/tmtrack.js')) {
  injectScript(endpoint + '/tmtrack.js', data.gtmOnSuccess(), data.gtmOnFailure());
} else {
  log('Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "TMTRACK"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.mytrack.pro/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 31/08/2020, 19:49:44


